# Instructions for setting up a new project

This is mostly based on this tutorial:
https://github.com/MaJerle/stm32-cube-cmake-vscode

But im trying to make te process a bit more quicker and compact.

## Step 0: Install the necessary tools
I will not go into detail on how to install these tools. (the original tutorial does a great job of that)
To check if you have the tools installed, you can run the following commands:

```bash
    arm-none-eabi-gcc --version
    STM32_Programmer_CLI --version
    ST-LINK_gdbserver --version

    cmake --version
    ninja --version
```

## Step 1: 
in your project folder, create a new folder to store the STM32CubeMX project. And generate the project using STM32CubeMX or STM32CubeIDE.

Keeping the STM32Cube files separate, allows you to use the generated files as starting point and orientation, but you have the freedom to put your code where you want. (you don't have to write code between the autogenerated comments)

## Step 2:
Copy the "Core" and "Drivers" folders, as well as the "STM32XXXXXX_FLASH.ld" file from the generated project to the root of your project folder.

## Step 3:
Copy all files from the template folder to the root of your project folder.

## Step 4:

Do the following modifications to the CMakeLists.txt file:

* Name the project ('project(xxxx)')
* Set the cpu-parameter:
    ```cmake
        -mcpu=cortex-m7
        -mfpu=fpv5-d16
        -mfloat-abi=hard 
    ```

* Set the linker script:
    ```cmake
        ${PROJ_PATH}/STM32XXXXXX_FLASH.ld
    ```

* Set source files:
    ```cmake
        ${PROJ_PATH}/Core/Src/main.c
        ${PROJ_PATH}/Core/Src/stm32h7xx_it.c
        ${PROJ_PATH}/Core/Src/syscalls.c
        ${PROJ_PATH}/Core/Src/sysmem.c
        ${PROJ_PATH}/Core/Src/system_stm32h7xx.c
        ${PROJ_PATH}/Core/Startup/startup_stm32h735igkx.s
        ${PROJ_PATH}/Drivers/...
        ...
    ```

* Set include directories:
    ```cmake
        ${PROJ_PATH}/Core/Inc
        ${PROJ_PATH}/Drivers/.../Inc
        ${PROJ_PATH}/Drivers/CMSIS/Include
        ${PROJ_PATH}/Drivers/CMSIS/Device/ST/.../Include
    ```

* Set the symbols:
    ```cmake
        "DEBUG"
        "STM32H735xx"
        "USE_FULL_LL_DRIVER"
        "HSE_VALUE=XXXX" #external crystal frequency (in Hz)
    ```